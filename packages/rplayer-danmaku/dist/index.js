!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("rplayer")):"function"==typeof define&&define.amd?define("RPlayerDanmaku",["rplayer"],e):"object"==typeof exports?exports.RPlayerDanmaku=e(require("rplayer")):t.RPlayerDanmaku=e(t.RPlayer)}(window,function(n){return r={},o.m=i=[function(t,e){t.exports=n},,function(t,e,r){"use strict";var n,i,o=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},s=(i={},function(t){if(void 0===i[t]){var e=document.querySelector(t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}i[t]=e}return i[t]}),c=[];function u(t){for(var e=-1,n=0;n<c.length;n++)if(c[n].identifier===t){e=n;break}return e}function h(t,e){for(var n={},i=[],o=0;o<t.length;o++){var r=t[o],s=e.base?r[0]+e.base:r[0],a=n[s]||0,h="".concat(s," ").concat(a);n[s]=a+1;var p=u(h),l={css:r[1],media:r[2],sourceMap:r[3]};-1!==p?(c[p].references++,c[p].updater(l)):c.push({identifier:h,updater:function(e,t){var n,i,o;{var r;o=t.singleton?(r=y++,n=m=m||d(t),i=f.bind(null,n,r,!1),f.bind(null,n,r,!0)):(n=d(t),i=function(t,e,n){var i=n.css,o=n.media,r=n.sourceMap;o?t.setAttribute("media",o):t.removeAttribute("media");r&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */"));if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,n,t),function(){!function(t){if(null===t.parentNode)return;t.parentNode.removeChild(t)}(n)})}return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}(l,e),references:1}),i.push(h)}return i}function d(t){var e,n=document.createElement("style"),i=t.attributes||{};if(void 0!==i.nonce||(e=r.nc)&&(i.nonce=e),Object.keys(i).forEach(function(t){n.setAttribute(t,i[t])}),"function"==typeof t.insert)t.insert(n);else{var o=s(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}return n}var a,p=(a=[],function(t,e){return a[t]=e,a.filter(Boolean).join("\n")});function f(t,e,n,i){var o,r,s=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;t.styleSheet?t.styleSheet.cssText=p(e,s):(o=document.createTextNode(s),(r=t.childNodes)[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o))}var m=null,y=0;t.exports=function(t,s){(s=s||{}).singleton||"boolean"==typeof s.singleton||(s.singleton=o());var a=h(t=t||[],s);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var e=0;e<a.length;e++){var n=u(a[e]);c[n].references--}for(var i=h(t,s),o=0;o<a.length;o++){var r=u(a[o]);0===c[r].references&&(c[r].updater(),c.splice(r,1))}a=i}}}},function(t,e,n){"use strict";t.exports=function(n){var h=[];return h.toString=function(){return this.map(function(t){var e=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var o=function(t){var e=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),n="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(e);return"/*# ".concat(n," */")}(i),r=i.sources.map(function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")});return[n].concat(r).concat([o]).join("\n")}return[n].join("\n")}(t,n);return t[2]?"@media ".concat(t[2]," {").concat(e,"}"):e}).join("")},h.i=function(t,e,n){"string"==typeof t&&(t=[[null,t,""]]);var i={};if(n)for(var o=0;o<this.length;o++){var r=this[o][0];null!=r&&(i[r]=!0)}for(var s=0;s<t.length;s++){var a=[].concat(t[s]);n&&i[a[0]]||(e&&(a[2]?a[2]="".concat(e," and ").concat(a[2]):a[2]=e),h.push(a))}},h}},,,,,,,,,,function(t,e){t.exports='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8.528 21.135v2.305H6.207v-2.305h2.321m4.642 0v2.305h-2.321v-2.305h2.321m4.641 0v2.305h-2.32v-2.305h2.32m3.482-2.305H2.726a2.312 2.312 0 0 1-2.321-2.305V2.696A2.314 2.314 0 0 1 2.726.391h18.567a2.314 2.314 0 0 1 2.321 2.305v13.829a2.313 2.313 0 0 1-2.321 2.305m-10.444-8.067H8.528v2.305h2.321v-2.305m9.283 0H13.17v2.305h6.962v-2.305M6.207 6.153H3.886v2.305h2.321V6.153m13.925 0H8.528v2.305h11.604V6.153z"></path></svg>'},,,,,function(t,e,n){var i=n(2),o=n(19);"string"==typeof(o=o.__esModule?o.default:o)&&(o=[[t.i,o,""]]);var r={insert:"head",singleton:!1},s=(i(o,r),o.locals?o.locals:{});t.exports=s},function(t,e,n){(e=n(3)(!1)).push([t.i,".rplayer_dan{position:absolute;top:0;left:0;right:0;bottom:0;pointer-events:none;overflow:hidden;font-family:SimHei,Microsoft JhengHei,Arial,Helvetica,sans-serif}.rplayer_dan_d{position:absolute;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap;will-change:transform;font-weight:700;line-height:1.125;color:#fff;text-shadow:#000 1px 1px 2px,#000 0 0 1px}.rplayer_dan_d-me{outline:1px solid currentColor;z-index:1}.rplayer_dan_d-center{left:50%;transform:translateX(-50%)}.rplayer_dan_tray-active{background:#448aff!important;background:var(--rplayer-primary)!important}.rplayer_dan_tray-active .rplayer_tray_tip{opacity:0!important}",""]),t.exports=e},,,function(t,e,n){"use strict";n.r(e);var i=n(0),T=n.n(i);function o(t,e,n,i,o){this.showFrame=0,this._width=0,this.speed=0,this.canRecycle=!1,this.danmaku=t,this.dom=T.a.utils.newElement("rplayer_dan_d"),t.dom.appendChild(this.dom),this.reset(e,n,i,o)}var r=(Object.defineProperty(o.prototype,"width",{get:function(){return this._width||(this._width=this.measure().width),this._width},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"invisibleLength",{get:function(){return this.width+this.length},enumerable:!0,configurable:!0}),o.prototype.measure=function(){var t=this.dom.getBoundingClientRect();return t.height&&this.danmaku.updateTunnelHeight(t.height+1),t},o.prototype.reset=function(t,e,n,i){var o,r,s;return this.dom.innerText=t.text,t.color&&(this.dom.style.color=t.color),t.fontFamily&&(this.dom.style.fontFamily=t.color),t.isMe&&this.dom.classList.add("rplayer_dan_d-me"),this.type=t.type,this.tunnel=e,this.updateVertical(),this.type&&"scroll"!==this.type?this.dom.classList.add("rplayer_dan_d-center"):(this.length=Math.max(n,0)+this.danmaku.fontSize,0<=n&&i?this.speed=i:(r=(o=this.danmaku.player.rect.width)+this.length,this.speed=(this.width+r)/this.danmaku.opts.scrollFrame,i&&n<0&&(s=r*i/(o+n))<this.speed&&(this.speed=s)),this.updateX(),this.dom.style.right="-"+this.width+"px"),this.canRecycle=!1,this.show(),this},o.prototype.updateVertical=function(){this.dom.style["bottom"===this.type?"bottom":"top"]=this.tunnel*this.danmaku.tunnelHeight+"px"},o.prototype.updateX=function(){this.dom.style.transform="translateX("+this.length+"px)"},o.prototype.show=function(){this.dom.hidden=!1},o.prototype.hide=function(){this.dom.hidden=!0},o.prototype.update=function(){if(!this.canRecycle)if("top"===this.type||"bottom"===this.type){if(this.showFrame>this.danmaku.opts.staticFrame)return this.canRecycle=!0,void this.hide();this.showFrame++}else{if(-this.length>=this.danmaku.player.rect.width+this.width)return this.canRecycle=!0,void this.hide();this.length-=this.speed,this.updateX()}},o.prototype.recycle=function(){this.canRecycle=!0,this.showFrame=0,this._width=0,this.speed=0,this.dom.style.color="",this.dom.style.fontFamily="",this.dom.style.right="",this.dom.style.top="",this.dom.style.bottom="",this.dom.style.transform="",this.dom.classList.remove("rplayer-dan-me"),this.dom.classList.remove("rplayer_dan_d-center"),this.hide()},o.prototype.destroy=function(){this.hide(),this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.canRecycle=!0},o),s=n(13),a=n.n(s);function h(t){var e=this;this.onOnOffChange=function(){},this.onTrayClick=function(){e.tray.dom.classList.add(h.trayActiveCls),e.popover.show()},this.onTrayHide=function(){e.tray.dom.classList.remove(h.trayActiveCls)},this.danmaku=t,this.dom=T.a.utils.newElement(),this.tray=new T.a.Tray({label:"弹幕",icons:[T.a.utils.svgToDom(a.a,"rplayer_dan_icon")],onClick:this.onTrayClick}),this.popover=new T.a.Popover({player:this.danmaku.player,onHide:this.onTrayHide}),this.popover.mount(this.tray.dom),this.initPopover(),this.danmaku.player.controls.addTray(this.tray.dom,3)}var p=(h.prototype.render=function(){},h.prototype.newSettingItem=function(){return T.a.utils.newElement()},h.prototype.newSettingLabel=function(t,e){var n=T.a.utils.newElement();return n.innerText=t,e&&n.classList.add(e),n},h.prototype.initPopover=function(){var t=this.newSettingItem(),e=this.newSettingLabel("弹幕"),n=new T.a.Switch({onChange:this.onOnOffChange});t.appendChild(e),t.appendChild(n.dom);var i=this.newSettingItem(),o=this.newSettingLabel("按类型屏蔽"),r=T.a.utils.newElement(),s=new T.a.Checkbox({label:"滚动"}),a=new T.a.Checkbox({label:"顶部"}),h=new T.a.Checkbox({label:"底部"}),p=new T.a.Checkbox({label:"彩色"});r.appendChild(s.dom),r.appendChild(a.dom),r.appendChild(h.dom),r.appendChild(p.dom),i.appendChild(o),i.appendChild(r);var l=this.newSettingItem(),c=this.newSettingLabel("不透明度"),u=new T.a.Slider({});l.appendChild(c),l.appendChild(u.dom);var d=this.newSettingItem(),f=this.newSettingLabel("显示区域"),m=new T.a.Slider({});d.appendChild(f),d.appendChild(m.dom);var y=this.newSettingItem(),v=this.newSettingLabel("字体大小"),g=new T.a.Slider({});y.appendChild(v),y.appendChild(g.dom);var b=this.newSettingItem(),w=new T.a.Checkbox({label:"不限弹幕"}),S=new T.a.Checkbox({label:"从下到上"}),C=new T.a.Checkbox({label:"合并重复"});b.appendChild(w.dom),b.appendChild(S.dom),b.appendChild(C.dom);var x=this.newSettingItem(),k=this.newSettingLabel("恢复默认设置");x.appendChild(k),this.popover.append(t),this.popover.append(i),this.popover.append(l),this.popover.append(d),this.popover.append(y),this.popover.append(b),this.popover.append(x)},h.trayActiveCls="rplayer_dan_tray-active",h);function l(t){var e,i=this;this.tunnel=0,this.opacity=1,this.tunnelHeight=0,this.unlimited=!1,this.showing=!1,this.running=!1,this.remain=[],this.current=[],this.last=[],this.pool=[],this.top=[],this.bottom=[],this.prevCurrentTime=0,this.onPlayerSeeked=function(){i.clear(),i.remain=i.opts.items},this.updateTunnel=function(){if(i.player){var t=i.player.rect.height;if(t){i.tunnel=i.area*t/i.tunnelHeight|0;var e=Math.max(i.last.length,i.top.length,i.bottom.length);if(e>i.tunnel)for(var n=i.tunnel;n<e;n++)i.recycleDan(i.last[n]),i.recycleDan(i.top[n]),i.recycleDan(i.bottom[n]),i.last[n]=void 0,i.top[n]=void 0,i.bottom[n]=void 0;i.current.forEach(function(t){return t.updateVertical()}),i.tunnel<1?i.hide():i.show()}}},this.pause=function(){cancelAnimationFrame(i.timer),i.running=!1},this.update=function(){i.running||(i.running=!0,i.render())},this.render=function(){if(i.load(),i.fire(),i.clean(),!i.current.length&&!i.remain.length)return i.hide();i.timer=requestAnimationFrame(i.render)},this.run=function(){i.updateTunnel(),i.show(),i.player.playing||i.pause()},this.dom=T.a.utils.newElement("rplayer_dan"),this.opts=((e=t).area=T.a.utils.isNum(e.area)?e.area:.5,e.opacity=e.opacity||1,e.items=e.items||[],e.staticFrame=e.staticFrame||300,e.scrollFrame=e.scrollFrame||500,e.blockTypes=e.blockTypes||[],e);var n=this.opts.items;this.opts.items=[],this.push(n),this.updateOpacity(this.opts.opacity),this.updateArea(this.opts.area),this.updateFontSize(this.opts.fontSize)}var c=(l.prototype.install=function(t){this.player=t,this.player.appendChild(this.dom),t.on(T.a.Events.PAUSE,this.pause),t.on(T.a.Events.LOADING_SHOW,this.pause),t.on(T.a.Events.LOADING_HIDE,this.update),t.on(T.a.Events.PLAY,this.update),t.on(T.a.Events.ENDED,this.pause),t.on(T.a.Events.PLAYER_RESIZE,this.updateTunnel),t.on(T.a.Events.SEEKED,this.onPlayerSeeked),document.contains(this.player.dom)?this.run():t.once(T.a.Events.MOUNTED,this.run),this.ui=new p(this)},l.prototype.updateTunnelHeight=function(t){t&&this.tunnelHeight<t&&(this.tunnelHeight=t,this.updateTunnel())},l.prototype.updateArea=function(t){T.a.utils.isNum(t)&&(this.unlimited=1<t,this.area=T.a.utils.clamp(t),this.updateTunnel())},l.prototype.updateOpacity=function(t){T.a.utils.isNum(t)&&(this.opacity=T.a.utils.clamp(t),this.dom.style.opacity=this.opacity.toString())},l.prototype.updateFontSize=function(t){T.a.utils.isNum(t)?this.fontSize=t:this.fontSize=this.getFontSize(),this.tunnelHeight||(this.tunnelHeight=this.fontSize),this.updateTunnel(),this.dom.style.fontSize=this.fontSize+"px"},l.prototype.updateScrollFrame=function(t){t&&(this.opts.scrollFrame=t)},l.prototype.updateStaticFrame=function(t){t&&(this.opts.staticFrame=t)},l.prototype.getFontSize=function(){return T.a.utils.getClientWH()[0]<769?15:23},l.prototype.hide=function(){this.showing=!1,this.pause(),this.clear()},l.prototype.show=function(){this.showing||(this.showing=!0,this.pause(),this.update())},l.prototype.clear=function(){var e=this;this.current.forEach(function(t){return e.recycleDan(t)}),this.current=[],this.last=[],this.top=[],this.bottom=[]},l.prototype.toggleBlockType=function(e){var n=this;e&&(this.opts.blockTypes.includes(e)?(this.opts.blockTypes=this.opts.blockTypes.filter(function(t){return t!==e}),this.remain=this.opts.items):(this.opts.blockTypes.push(e),this.remain=this.remain.filter(function(t){return t.type!==e}),this.current=this.current.filter(function(t){return t.type!==e||(n.recycleDan(t),!1)})))},l.prototype.send=function(t){t.isMe=!0,this.opts.items.push(t),this.insert(t,0,!0)},l.prototype.push=function(t){var e,n,i=this;t&&(Array.isArray(t)?((e=this.opts.items).push.apply(e,t),this.opts.blockTypes.length&&(t=t.filter(function(t){return!i.opts.blockTypes.includes(t.type)})),(n=this.remain).push.apply(n,t)):(this.opts.items.push(t),this.opts.blockTypes.includes(t.type)||this.remain.push(t)))},l.prototype.getDan=function(t,e,n,i){var o=this.pool.pop();return o?o.reset(t,e,n,i):new r(this,t,e,n,i)},l.prototype.recycleDan=function(t){t&&(20<this.pool.length?t.destroy():(t.recycle(),this.pool.push(t)))},l.prototype.getShortestTunnel=function(){for(var t=1/0,e=-1,n=0,i=0;i<this.tunnel;i++){if(!this.last[i]||this.last[i].canRecycle)return[i,0,0];var o=this.last[i].invisibleLength;o<t&&(t=o,e=i,n=this.last[i].speed)}return[e,t,n]},l.prototype.insert=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=!1),t){if("top"===t.type||"bottom"===t.type){for(var i=-1,o=0;o<this.tunnel;o++)if(!this[t.type][o]||this[t.type][o].canRecycle){i=o;break}-1<i&&(this[t.type][i]=this.getDan(t,i),this.current.push(this[t.type][i]),t=void 0)}else{var r=this.getShortestTunnel(),i=r[0],s=r[1],a=r[2];s<200&&(this.last[i]=this.getDan(t,i,s,a),this.current.push(this.last[i]),t=void 0)}(t&&this.unlimited||n)&&this.current.push(this.getDan(t,e%this.tunnel,e))}},l.prototype.load=function(){if(this.showing&&this.player&&this.remain.length&&!(this.tunnel<1)){var e=0|this.player.currentTime;if(this.prevCurrentTime!==e){this.prevCurrentTime=e;var n=[],i=[];if(this.remain.forEach(function(t){t.time===e?i.push(t):n.push(t)}),this.remain=n,i.length)for(var t=0,o=i.length;t<o;t++){var r=i[t];if(!r||!r.text)break;this.insert(r,t)}}}},l.prototype.fire=function(){this.current.forEach(function(t){return t.update()})},l.prototype.clean=function(){var e=this,n=[];this.current.forEach(function(t){t.canRecycle?e.recycleDan(t):n.push(t)}),this.current=n;for(var t=0;t<this.tunnel;t++)this.last[t]&&this.last[t].canRecycle&&(this.last[t]=void 0),this.top[t]&&this.top[t].canRecycle&&(this.top[t]=void 0),this.bottom[t]&&this.bottom[t].canRecycle&&(this.bottom[t]=void 0)},l);n(18),e.default=c}],o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=22).default;function o(t){if(r[t])return r[t].exports;var e=r[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,o),e.l=!0,e.exports}var i,r});
//# sourceMappingURL=index.js.map